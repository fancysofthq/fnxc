# The module all structs derive from.
reopen Struct
  def after_initialize
    \{% for field in _type:instance_fields() do %}
      @ref(\{{ field }})
    \{% end %}

    \{% if _type:has_method("referencees") then %}
      referencees -> @ref(&)
    \{% end %}
  end

  def finalize
    \{% for field in _type:instance_fields() do %}
      @deref(\{{ field }})
    \{% end %}

    \{% if _type:has_method("referencees") then %}
      referencees -> @deref(&)
    \{% end %}
  end
end
